<!DOCTYPE html>
<html>
<head>
    <title>公式编辑器</title>
    <meta charset="UTF-8">
    <script src="dev-lib/kitygraph.all.js"></script>
    <script src="dev-lib/kity-formula.all.js"></script>
    <script src="dev-lib/kityformula-parser.all.js"></script>
    <script src="dev-lib/sea-debug.js"></script>
    <script>
        window.onload = function () {

            var assembly = kf.Assembly.use( document.getElementsByClassName( "kf-editor-container" )[ 0 ], {
                        fontsize: 50,
                        autoresize: false
                    } ),
                parser = kf.Parser.use( "latex" ),
                viewPort = assembly.formula.getViewPort(),
                formulaSpace = null,
                REZISE_TIMER = null;

            // 输入数据
            var currentLatexStr = 'a+b-3\\div 4';

            generateFormula( currentLatexStr );

            function generateFormula ( latexStr ) {

                assembly.regenerateBy( parser.parse( latexStr ) );

                formulaSpace = assembly.formula.container.getRenderBox();

                viewPort.center.x = formulaSpace.width / 2;
                viewPort.center.y = formulaSpace.height / 2;
                assembly.formula.setViewPort( viewPort );

            }

            /* 滚轮事件 */
            document.addEventListener( "mousewheel", function ( e ) {

                if ( e.wheelDelta > 0 ) {
                    enlargeView();
                } else {
                    narrowView();
                }

            } );


            function enlargeView () {
                updateViewZoom( 1.05 );
            }

            function narrowView () {
                updateViewZoom( 0.95 );
            }

            function updateViewZoom ( zoom ) {

                var viewPort = assembly.formula.getViewPort();

                zoom = viewPort.zoom * zoom;

                if ( zoom < 0.5 || zoom > 5 ) {
                    return false;
                }

                viewPort.zoom = zoom;

                assembly.formula.setViewPort( viewPort );

            }

            /* 视图变化 重新渲染 */
            window.onresize = function () {

                if ( REZISE_TIMER !== null ) {
                    window.clearTimeout( REZISE_TIMER );
                }

                REZISE_TIMER = window.setTimeout( function () {

                    generateFormula( currentLatexStr );

                }, 100 );

            };


        };

    </script>
    <link rel="stylesheet" href="assets/styles/page.css">
    <link rel="stylesheet" href="assets/styles/base.css">
</head>
<body>
    <div class="kf-editor">
        <div class="kf-editor-toolbar"></div>
        <div class="kf-editor-container"></div>
    </div>
</body>
</html>